<html>
<head>
<link href="resources/bootstrap/css/bootstrap.css" rel="stylesheet"
	media="screen">
<script type="text/javascript"
	src="resources/js/jquery-1.9.1.js"></script>
<script src="resources/bootstrap/js/bootstrap.min.js"
	type="text/javascript"></script>
<script src="resources/js/dropzone.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link href="resources/css/dataManageTree/zzsc.css" rel="stylesheet"
	type="text/css" />
<script src="resources/js/dataManageTree/showlist.js"
	type="text/javascript"></script>



<style type="text/css">
html {
	overflow-x:hidden;
}
.my {
	float: right;
}

.mynav>li.active>a,.mynav>li.active>a:hover,.mynav>li.active>a:focus {
	background-color: #08c;
	color: white;
}

.mynav {
	margin-left: 20px;
}

.section_header p {
	padding: 0px;
	margin: 0px;
	color: #000;
}

.section_header {
	padding: 0;
	padding-bottom: 5px;
	margin-bottom: 20px;
	font-size: 21px;
	line-height: 40px;
	color: #333;
	border: 0;
	border-bottom: 1px solid #06C;
}
</style>
</head>
<body>
	<div class="section_header">
		<div class="btn-group pull-right">
			<button class="btn add" data-loading-text="正在添加">添加</button>
			<button class="btn refresh btn-primary" data-loading-text="正在刷新">刷新</button>
		</div>
		<p>全部活动</p>
	</div>
	<div id="tmp_1"></div>


	<div class="pagination">
		<ul>
			<li class="next la"><a href="#">&laquo;</a></li>
			<li class="first"><a href="#">1</a></li>
			<li class="next ra"><a href="#">&raquo;</a></li>
		</ul>
	</div>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>#</th>
				<th>活动类型</th>
				<th>描述链接</th>
				<th>图片链接</th>
				<th>得分</th>
				<th>积分</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
			<tr class="hide temple">
				<td class="id" style="padding-top:12px">1</td>
				<td class="type" style="padding-top:12px">1</td>
				<td class="desc"><a class="btn btn-link descURL">查看</a></td>
				<td class="activity"><a class="btn btn-link activityURL">查看</a>
				</td>
				<td class="score" style="padding-top:12px">Otto</td>
				<td class="credit" style="padding-top:12px"></td>
				<td class="oper"><button class="btn btn-primary">操作</button>
				</td>
			</tr>
		</tbody>
	</table>
	<div class="modal hide fade show">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">&times;</button>
			<h3>链接内容</h3>
		</div>
		<div class="modal-body">
			<p>One fine body…</p>
		</div>
	</div>
	<div class="modal hide fade oper">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">&times;</button>
			<h3>操作</h3>
		</div>
		<div class="modal-body">
			<a href="#" class="btn btn-danger">删除</a> <a href="#"
				class="btn btn-primary change">修改</a> <a href="#"
				class="btn btn-primary reupload hide">重新上传</a>
			<form class="form-horizontal hide" style="margin-top:10px">
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动类型</label>
					<div class="controls type">
						<input type="text" id="inputEmail" placeholder="type">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动描述</label>
					<div class="controls">
						<a class="btn btn-link desc" style="padding-left:0px">点此上传</a> <a
							class="btn btn-link hide temple"
							style="padding-left:0px;
					      color:rgb(51,51,51);
					      cursor:deault;
					      text-decoration:none;
					      "></a>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动图片</label>
					<div class="controls">
						<a class="btn btn-link activity" style="padding-left:0px">点此上传</a>
						<a class="btn btn-link hide temple"
							style="padding-left:0px;
					      color:rgb(51,51,51);
					      cursor:deault;
					      text-decoration:none;
					      "></a>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">得分</label>
					<div class="controls score">
						<input type="text" id="" placeholder="score">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputPassword">积分</label>
					<div class="controls credit">
						<input type="text" id="" placeholder="credit">
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn">关闭</a> <a href="#"
				class="btn btn-primary save">Save changes</a>
		</div>
	</div>
	<div class="modal hide fade add">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">&times;</button>
			<h3>操作</h3>
		</div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动类型</label>
					<div class="controls type">
						<input type="text" id="inputEmail" placeholder="type">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动描述</label>
					<div class="controls">
						<a class="btn btn-link" style="padding-left:0px">点此上传</a>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">活动图片</label>
					<div class="controls">
						<a class="btn btn-link" style="padding-left:0px">点此上传</a>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputEmail">得分</label>
					<div class="controls score">
						<input type="text" id="" placeholder="score">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputPassword">积分</label>
					<div class="controls credit">
						<input type="text" id="" placeholder="credit">
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn">关闭</a> <a href="#"
				class="btn btn-primary save">Save changes</a>
		</div>
	</div>
	<div id="upload" style="display:none"></div>
	<form id="pictures">
		<input class="uploaddesc" type="file" name="pics" /> <input
			class="uploadactivity" type="file" name="pics" />
	</form>

	<script>
		/**  首页轮换图 **/
		function autoTurnManage() {
			$.ajax({
				url : "getCarouselInfo.action",
				type : "POST",
				data : {},
				success : function(data) {
					var data_tmp = JSON.parse(data);
					var arr_tmp = data_tmp["carousels"];
					/** 如果大于1那么默认会每次点击清空table信息，保留第一行隐藏行用于clone方法 **/
					if ($("table").find("tr").length > 1) {
						$("table tr:gt(0):not(:eq(0))").remove();
					}
					var lineCount = 1;
					for ( var i = 0; i < arr_tmp.length; i++) {

						var arr = arr_tmp[i];
						for ( var i = 0; i < arr.length; i++) {
							var $tr = $("table").find("tr.temple").clone();
							$tr.data("data", arr[i]);
							$tr.removeClass("hide");
							$tr.removeClass("temple");
							$tr.find(".id").text((lineCount) + "");
							$tr.find(".desc").data("data", arr[i]["url"]);
							/**  绑定目标url点击事件 **/
							$tr.find("a.descURL").bind(
									"click",
									function() {
										var $tmp = $(this).parent();
										console.log($tmp.data("data"));
										$(".modal.show").find(".modal-body")
												.find("p").text(
														$tmp.data("data"));
										$(".modal.show").modal("show");
									});

							$tr.find(".activity").data("data",
									arr[i]["imageUrl"]);

							/**  绑定点击事件 **/
							$tr.find("a.activityURL").bind(
									"click",
									function() {
										var $tmp = $(this).parent();
										console.log($tmp.data("data"));
										$(".modal.show").find(".modal-body")
												.find("p").text(
														$tmp.data("data"));
										$(".modal.show").modal("show");
									});

							$tr.find(".score").text("无");
							$tr.find(".credit").text("无");
							$tr.find(".oper").bind(
									"click",
									function() {
										$(".modal.oper").data("data",
												$(this).parent().data("data"));
										$(".modal.oper").modal("show");
										$(".mynav").data("data",
												$(".modal.oper"));
									});
							$tr.appendTo($("table"));
							lineCount++;
						}
					}

				},
			});
		}

		$(function() {
			/**	活动页面的js **/
			$.ajax({
				url : "ActivityList.action",
				type : "POST",
				data : {},
				success : function(data) {
					var data_tmp =JSON.parse(data);
					var arr = data_tmp["activities"];
					for ( var i = 0; i < arr.length; i++) {
						var $tr = $("table").find("tr.temple").clone();
						$tr.data("data", arr[i]);
						$tr.removeClass("hide");
						$tr.removeClass("temple");
						$tr.find(".id").text((i + 1) + "");
						$tr.find(".type").text(arr[i]["type"]);
						$tr.find(".desc").data("data", arr[i]["descUrl"]);
						$tr.find("a.descURL").bind(
								"click",
								function() {
									var $tmp = $(this).parent();
									console.log($tmp.data("data"));
									$(".modal.show").find(".modal-body").find(
											"p").text($tmp.data("data"));
									$(".modal.show").modal("show");
								});
						$tr.find(".activity").data("data",
								arr[i]["activityUrl"]);
						$tr.find("a.activityURL").bind(
								"click",
								function() {
									var $tmp = $(this).parent();
									console.log($tmp.data("data"));
									$(".modal.show").find(".modal-body").find(
											"p").text($tmp.data("data"));
									$(".modal.show").modal("show");
								});
						$tr.find(".score").text(arr[i]["score"]);
						$tr.find(".credit").text(arr[i]["credit"]);
						$tr.find(".oper").bind(
								"click",
								function() {
									$(".modal.oper").data("data",
											$(this).parent().data("data"));
									$(".modal.oper").modal("show");
									$(".mynav").data("data", $(".modal.oper"));
								});
						$tr.appendTo($("table"));
					}
					$("li.all").trigger("getinfo");

				}
			});

			$(".modal.oper").bind("show", function() {
			});
			$(".modal.oper").find(".btn.save").bind("click", function() {
				var type = $(".oper .controls.type").find("input").val();
				var credit = $(".oper .controls.credit").find("input").val();
				var score = $(".oper .controls.score").find("input").val();
				var fileobj1 = $("input.uploaddesc")[0].files[0];
				var fileobj2 = $("input.uploadactivity")[0].files[0];
				// FormData 对象
				console.log(fileobj1);
				var arr = [];
				arr.push(fileobj1.name);
				arr.push(fileobj2.name);
				var form = new FormData($("#pictures")[0]);
				form.append("aid", $(".modal.oper").data("data")["aid"]);
				form.append("credit", parseInt(credit));
				form.append("score", parseInt(score));
				form.append("descIndex", 0);
				form.append("activityIndex", 1);
				form.append("picsName", arr);
				//form.append("pics", fileobj1);
				//form.append("pics", fileobj2);                          
				// XMLHttpRequest 对象
				var xhr = new XMLHttpRequest();
				xhr.open("post", "UpdateActivity.action", true);
				xhr.onload = function() {
					alert("上传完成!");
				};
				xhr.send(form);
				//console.log("上传");
				//myDropzone.processQueue();
			});
			$(".modal.oper").find(".btn-link.desc").bind("click", function() {
				$(".uploaddesc").trigger("click");
			});
			$(".modal.oper").find(".btn-link.activity").bind("click",
					function() {
						$(".uploadactivity").trigger("click");
						//alert("");
					});
			$(".modal.oper").find(".btn.save").bind("click", function() {
			});
			$(".modal.oper").find(".btn-link.desc").bind("click", function() {

			});
			$(".modal.oper").bind("hide", function() {
				$(".oper").find("form").addClass("hide");
			});
			$(".modal-footer").find(".btn").bind("click", function() {

				var $modal
				$(".modal.oper").modal("hide");
				$(".modal.add").modal("hide");
			});
			$(".btn.btn-danger").bind("click", function() {
				//var $modal=$(".mynav").data("data");
				var obj = $(".modal.oper").data("data");
				$.ajax({
					url : "test.action",
					type : "POST",
					data : {
						"data" : obj.aid
					},
					success : function(data) {
						alert("success");
					},
				});
			});

			$(".btn.change").bind("click", function() {
				//console.log($(".modal.oper").data("data"));
				$(".oper").find("form").removeClass("hide");
				var obj = $(".modal.oper").data("data");
				//console.log(obj);
				$(".oper .controls.type").find("input").val(obj["type"]);
				$(".oper .controls.credit").find("input").val(obj["credit"]);
				$(".oper .controls.score").find("input").val(obj["score"]);
			});
			$(".btn.add").bind("click", function() {
				$(".modal.add").modal("show");
				$(".mynav").data("data", $(".modal.add"));
			});
		});
	</script>
</body>
</html>