(function(a){var u={},t={},h={};function m(D,z,B){var y=this,x,C,A;z=z||{};C=a.extend({overwriteCache:false,complete:null,success:null,error:function(){a(this).each(function(){a(this).html(C.errorMessage)})},errorMessage:"There was an error loading the template.",paged:false,pageNo:1,elemPerPage:10,append:false,prepend:false,beforeInsert:null,afterInsert:null},B);if(a.type(z)==="array"){return r.call(this,D,z,C)}if(!g(D)){x=a(D);if(typeof D==="string"&&D.indexOf("#")===0){C.isFile=false}}A=C.isFile||(typeof C.isFile==="undefined"&&(typeof x==="undefined"||x.length===0));if(A&&!C.overwriteCache&&u[D]){p(D,y,z,C)}else{if(A&&!C.overwriteCache&&u.hasOwnProperty(D)){c(D,y,z,C)}else{if(A){l(D,y,z,C)}else{n(x,y,z,C)}}}return this}function b(y,x){if(x){h[y]=x}else{h=a.extend(h,y)}}function g(x){return typeof x==="string"&&x.indexOf("/")>-1}function r(G,y,D){D=D||{};var x=this,H=y.length,A=D.prepend&&!D.append,z=0,F=0,B=false,C;if(D.paged){var E=(D.pageNo-1)*D.elemPerPage;y=y.slice(E,E+D.elemPerPage);H=y.length}C=a.extend({},D,{complete:function(){if(A){x.prepend(this.html())}else{x.append(this.html())}z++;if(z===H){if(B&&D&&typeof D.error==="function"){D.error.call(x)}if(D&&typeof D.complete==="function"){D.complete()}}},success:function(){F++;if(F===H){if(D&&typeof D.success==="function"){D.success()}}},error:function(){B=true}});if(!D.append&&!D.prepend){x.html("")}if(A){y.reverse()}a(y).each(function(){var I=a("<div/>");m.call(I,G,this,C)});return this}function c(A,y,x,z){if(t[A]){t[A].push({data:x,selection:y,settings:z})}else{t[A]=[{data:x,selection:y,settings:z}]}}function p(B,z,y,A){var x=u[B].clone();o.call(z,x,y,A);if(typeof A.success==="function"){A.success()}}function v(){return new Date().getTime()}function w(x){if(x.indexOf("?")!==-1){return x+="&_="+v()}else{return x+="?_="+v()}}function l(B,z,y,A){var x=a("<div/>");u[B]=null;if(A.overwriteCache){B=w(B)}x.load(B,function(C,D){if(D==="error"){j(B,z,y,A)}else{k(x,B,z,y,A)}})}function n(x,A,z,B){var y=a("<div/>");if(x.is("script")){x=a.parseHTML(a.trim(x.html()))}y.html(x);o.call(A,y,z,B);if(typeof B.success==="function"){B.success()}}function o(z,x,y){f(z,x);a(this).each(function(){var A=a(z.html());if(y.beforeInsert){y.beforeInsert(A)}if(y.append){a(this).append(A)}else{if(y.prepend){a(this).prepend(A)}else{a(this).html(A)}}if(y.afterInsert){y.afterInsert(A)}});if(typeof y.complete==="function"){y.complete.call(a(this))}}function j(A,y,x,z){var B;if(typeof z.error==="function"){z.error.call(y)}a(t[A]).each(function(C,D){if(typeof D.settings.error==="function"){D.settings.error.call(D.selection)}});if(typeof z.complete==="function"){z.complete.call(y)}while(t[A]&&(B=t[A].shift())){if(typeof B.settings.complete==="function"){B.settings.complete.call(B.selection)}}if(typeof t[A]!=="undefined"&&t[A].length>0){t[A]=[]}}function k(x,B,z,y,A){var C;u[B]=x.clone();o.call(z,x,y,A);if(typeof A.success==="function"){A.success.call(z)}while(t[B]&&(C=t[B].shift())){o.call(C.selection,u[B].clone(),C.data,C.settings);if(typeof C.settings.success==="function"){C.settings.success.call(C.selection)}}}function f(y,x){x=x||{};s("data-content",y,x,function(z,A){z.html(e(z,A,"content"))});s("data-content-append",y,x,function(z,A){z.append(e(z,A,"content"))});s("data-content-prepend",y,x,function(z,A){z.prepend(e(z,A,"content"))});s("data-content-text",y,x,function(z,A){z.text(e(z,A,"content"))});s("data-src",y,x,function(z,A){z.attr("src",e(z,A,"src"))},function(z){z.remove()});s("data-alt",y,x,function(z,A){z.attr("alt",e(z,A,"alt"))});s("data-value",y,x,function(z,A){z.attr("value",e(z,A,"value"))});s("data-link",y,x,function(z,B){var A=a("<a/>");A.attr("href",e(z,B,"link"));A.html(z.html());z.html(A)});s("data-link-wrap",y,x,function(z,B){var A=a("<a/>");A.attr("href",e(z,B,"link-wrap"));z.wrap(A)});s("data-options",y,x,function(z,A){a(A).each(function(){var B=a("<option/>");B.attr("value",this).text(this).appendTo(z)})});q(y,x)}function s(x,B,y,z,A){a("["+x+"]",B).each(function(){var C=a(this),D=C.attr(x),E=i(y,D);C.removeAttr(x);if(typeof E!=="undefined"&&z){z(C,E)}else{if(A){A(C)}}});return}function q(y,x){a("[data-template-bind]",y).each(function(){var z=a(this),A=a.parseJSON(z.attr("data-template-bind"));z.removeAttr("data-template-bind");a(A).each(function(){var C;if(typeof(this.value)==="object"){C=i(x,this.value.data)}else{C=i(x,this.value)}if(typeof C!=="undefined"&&this.attribute){switch(this.attribute){case"content":z.html(d(z,C,this));break;case"contentAppend":z.append(d(z,C,this));break;case"contentPrepend":z.prepend(d(z,C,this));break;case"contentText":z.text(d(z,C,this));break;case"options":var B=this;a(C).each(function(){var D=a("<option/>");D.attr("value",this[B.value.value]).text(d(z,this[B.value.content],B)).attr("selected",typeof this[B.value.selected]==undefined?false:this[B.value.selected]).appendTo(z)});break;default:z.attr(this.attribute,d(z,C,this))}}})})}function d(x,z,y){if(y.formatter&&h[y.formatter]){return h[y.formatter].call(x,z,y.formatOptions)}return z}function i(x,y){if(y==="this"){return x}var z=y.split("."),A,B=x;while((A=z.shift())&&typeof B!=="undefined"){B=B[A]}return B}function e(x,C,y){var B=x.attr("data-format-target"),A;if(B===y||(!B&&y==="content")){A=x.attr("data-format");if(A&&typeof h[A]==="function"){var z=x.attr("data-format-options");return h[A].call(x[0],C,z)}}return C}b("nestedTemplateFormatter",function(A,x){if(!x){return}if(typeof x==="string"&&x[0]==="{"){x=a.parseJSON(x)}var y=x.parentElement||"div";var z=x.template||x;return a("<"+y+"/>").loadTemplate(z,A)});a.fn.loadTemplate=m;a.addTemplateFormatter=b})(jQuery);